FROM oven/bun:1.1-alpine

RUN apk add --no-cache git

WORKDIR /app

ENV REPO_URL=""
ENV REPO_REF=""
ENV VALUE_ONE=""
ENV VALUE_TWO=""

RUN [ -n "$REPO_URL" ] || (echo 'REPO_URL is required' && exit 2)
RUN git clone $REPO_URL /app
RUN [ -z "$REPO_REF" ] || (cd /app && git checkout $REPO_REF)
RUN cd /app && bun install

CMD ["sh", "-c", "VALUE_ONE=$VALUE_ONE VALUE_TWO=$VALUE_TWO bun run start || exec bun ."]
